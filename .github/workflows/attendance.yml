name: Kredily Auto Attendance (Playwright)

on:
  workflow_dispatch:
  schedule:
    - cron: "40 5 * * 1-6"   # 10:40 AM IST -> check-in (Mon-Sat)
    - cron: "0 12 * * 1-6"   # 6:00 PM IST -> check-out (Mon-Sat)

jobs:
  clockin:
    if: github.event_name == 'workflow_dispatch' || github.event.schedule == '40 5 * * 1-6' || false
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"

      - name: Install Playwright
        run: |
          pip install playwright requests
          playwright install --with-deps

      - name: Run Clock-In
        env:
          KREDILY_USER: ${{ secrets.KREDILY_USER }}
          KREDILY_PASS: ${{ secrets.KREDILY_PASS }}
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
          ACTION: "clockin"
        run: python3 kredily.py

  clockout:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"

      - name: Install Playwright
        run: |
          pip install playwright requests
          playwright install --with-deps

      - name: Run Clock-Out
        env:
          KREDILY_USER: ${{ secrets.KREDILY_USER }}
          KREDILY_PASS: ${{ secrets.KREDILY_PASS }}
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
          ACTION: "clockout"
        run: python3 kredily.py
